
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              72.506824,
              49.778612
            ],
            [
              72.500647,
              49.774086
            ],
            [
              72.501539,
              49.768151
            ],
            [
              72.496139,
              49.766745
            ],
            [
              72.50232,
              49.762845
            ],
            [
              72.506264,
              49.750274
            ],
            [
              72.506164,
              49.748598
            ],
            [
              72.505336,
              49.740077
            ],
            [
              72.504801,
              49.738819
            ],
            [
              72.501041,
              49.733716
            ],
            [
              72.4976,
              49.730008
            ],
            [
              72.505492,
              49.728836
            ],
            [
              72.513271,
              49.72864
            ],
            [
              72.514133,
              49.7292
            ],
            [
              72.518226,
              49.732279
            ],
            [
              72.522645,
              49.734799
            ],
            [
              72.527332,
              49.736689
            ],
            [
              72.529985,
              49.738445
            ],
            [
              72.536958,
              49.742736
            ],
            [
              72.54671,
              49.737114
            ],
            [
              72.556168,
              49.734365
            ],
            [
              72.564874,
              49.734247
            ],
            [
              72.56595,
              49.732776
            ],
            [
              72.568101,
              49.730095
            ],
            [
              72.56935,
              49.726465
            ],
            [
              72.571247,
              49.725521
            ],
            [
              72.573143,
              49.725189
            ],
            [
              72.574873,
              49.722185
            ],
            [
              72.577023,
              49.723134
            ],
            [
              72.578481,
              49.725418
            ],
            [
              72.580618,
              49.731377
            ],
            [
              72.579756,
              49.731376
            ],
            [
              72.580606,
              49.735664
            ],
            [
              72.580854,
              49.739449
            ],
            [
              72.58274,
              49.742791
            ],
            [
              72.585747,
              49.746134
            ],
            [
              72.598988,
              49.757451
            ],
            [
              72.573258,
              49.769198
            ],
            [
              72.558841,
              49.774986
            ],
            [
              72.555885,
              49.776796
            ],
            [
              72.548074,
              49.781049
            ],
            [
              72.545054,
              49.780773
            ],
            [
              72.54119,
              49.780813
            ],
            [
              72.53641,
              49.781894
            ],
            [
              72.53275,
              49.783749
            ],
            [
              72.529722,
              49.78574
            ],
            [
              72.526076,
              49.783648
            ],
            [
              72.52306,
              49.782463
            ],
            [
              72.518919,
              49.781686
            ],
            [
              72.516461,
              49.781455
            ],
            [
              72.511675,
              49.782391
            ],
            [
              72.506824,
              49.778612
            ]
          ]
        ]
      },
      "properties": {
        "id": "M1439.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "underground",
        "data source date": "2025-07-01 00:00:00",
        "notes": "The Kazakhstanskaya mine is part of the Karaganda Coal Mines Complex that includes eight underground coal mines and the Vostochnaya coal preparation plant. These mines are: Kostenko, Kuzembaeva, Saranskaya, Abayskaya, Kazakhstanskaya, Lenina, Shakhtinskaya and Tentekskaya coal mines. (https://web.archive.org/web/20250207022321/https://miningdataonline.com/property/1772/Karaganda-Coal-Mines-Complex.aspx). \n\nThe boundary was extracted from the Unified Platform for Subsoil Use, Ministry of Industry and Construction of the Republic of Kazakhstan https://web.archive.org/web/2/https://minerals.e-qazyna.kz/en/contracts-map. The Kazakhstanskaya boundary overlaps with the adjacent Lenina and Tentekskaya mine boundaries. Searching for the Kazakhstanskaya mine contact boundary in the search system was not effective.  Instead, the boundaries for Lenina and Tentekskaya mines were first identified, and then the Kazakhstanskaya deduced. The boundary is based on object 144, issued May 12 1997, of work type 'contracts mountain'.\n\nSection 1 General Information about the Enterprise, on page 14 of the 2020 Environmental Impact Assessment https://web.archive.org/web/2/https://www.gov.kz/uploads/2021/1/15/a529244bb914a677678f4ebd32056665_original.58771642.pdf refers to the approved technical boundaries in terms of coal seams; the dimensions of the mine field are given as 2500-7000m x 2500-5600m (or 6.25 sq km - 39 sq km). The area of the extracted boundary is 29.5 sq km which lies within this range. ",
        "description": "Kazakhstanskaya coal mine boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.568959,
          49.77029
        ]
      },
      "properties": {
        "id": "M1439.P3",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "vent",
        "data source date": "2023-06-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "ventilation shaft possibly shared or part of the adjacent Tentekskaya mine",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.563863,
          49.749058
        ]
      },
      "properties": {
        "id": "M1439.P4",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "shaft",
        "data source date": "2023-05-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "possible group of 4 ventilation shafts",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.531842,
          49.747583
        ]
      },
      "properties": {
        "id": "M1439.P6",
        "mine feature category": "degasification system",
        "mine feature subcategory": "drainage station",
        "data source date": "2023-06-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "possible gas drainage station",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.561943,
          49.749464
        ]
      },
      "properties": {
        "id": "M1439.P8",
        "mine feature category": "other",
        "mine feature subcategory": "shaft",
        "data source date": "2023-05-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "possible shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.561532,
          49.748934
        ]
      },
      "properties": {
        "id": "M1439.P9",
        "mine feature category": "other",
        "mine feature subcategory": "shaft",
        "data source date": "2023-05-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "possible shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.540145,
          49.768693
        ]
      },
      "properties": {
        "id": "M1439.P10",
        "mine feature category": "other",
        "mine feature subcategory": "shaft",
        "data source date": "2023-05-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "possible access shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.564754,
          49.749988
        ]
      },
      "properties": {
        "id": "M1439.P11",
        "mine feature category": "other",
        "mine feature subcategory": "slope access or production shaft",
        "data source date": "2023-05-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "possible slope or access",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.531337,
          49.745407
        ]
      },
      "properties": {
        "id": "M1439.P12",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "vent",
        "data source date": "2024-06-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "ventilation shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          72.566714,
          49.738556
        ]
      },
      "properties": {
        "id": "M1439.P13",
        "mine feature category": "other",
        "mine feature subcategory": "shaft",
        "data source date": "2023-06-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1439",
        "Owners": "Qarmet JSC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Qazaqstan Steel Group LLP",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Kazakhstanskaya_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Kazakhstanskaya Coal Mine",
        "Country / Area": "Kazakhstan",
        "Last researched": "Dec 26, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(49.722185, 72.496139), L.latLng(49.78574, 72.598988));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleStreet, googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleStreet, googleHybrid]}).setView([49.7539625, 72.5475635], 12.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Street view": googleStreet,
        "Satellite view": googleHybrid
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
	GEMMine = L.marker([49.75044, 72.563474], {icon: GEMMineIcon}).addTo(map); 
	GEMMine.bindPopup('Operating status(es): Operating');
	GEMMine.bindTooltip('Kazakhstanskaya Coal Mine', { permanent: true, direction: 'right'});
