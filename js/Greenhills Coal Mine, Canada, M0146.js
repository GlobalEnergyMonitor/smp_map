
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -114.936583,
              50.146049
            ],
            [
              -114.937849,
              50.144619
            ],
            [
              -114.937666,
              50.141481
            ],
            [
              -114.936427,
              50.137681
            ],
            [
              -114.932122,
              50.137396
            ],
            [
              -114.930413,
              50.13749
            ],
            [
              -114.926274,
              50.135967
            ],
            [
              -114.916733,
              50.137034
            ],
            [
              -114.913913,
              50.137777
            ],
            [
              -114.908164,
              50.1407
            ],
            [
              -114.909644,
              50.138411
            ],
            [
              -114.911689,
              50.136873
            ],
            [
              -114.913105,
              50.135404
            ],
            [
              -114.910505,
              50.135821
            ],
            [
              -114.908294,
              50.135992
            ],
            [
              -114.905595,
              50.13512
            ],
            [
              -114.905603,
              50.134297
            ],
            [
              -114.905918,
              50.132894
            ],
            [
              -114.908032,
              50.13237
            ],
            [
              -114.907668,
              50.13111
            ],
            [
              -114.903175,
              50.131704
            ],
            [
              -114.903411,
              50.130314
            ],
            [
              -114.904757,
              50.129387
            ],
            [
              -114.908627,
              50.128275
            ],
            [
              -114.902599,
              50.127881
            ],
            [
              -114.907138,
              50.125492
            ],
            [
              -114.905259,
              50.12497
            ],
            [
              -114.902228,
              50.12497
            ],
            [
              -114.89976,
              50.125902
            ],
            [
              -114.899989,
              50.123187
            ],
            [
              -114.900988,
              50.121379
            ],
            [
              -114.902801,
              50.119656
            ],
            [
              -114.905953,
              50.118027
            ],
            [
              -114.9088,
              50.117717
            ],
            [
              -114.912364,
              50.117004
            ],
            [
              -114.915501,
              50.115294
            ],
            [
              -114.915319,
              50.113471
            ],
            [
              -114.917621,
              50.110044
            ],
            [
              -114.915771,
              50.108593
            ],
            [
              -114.916407,
              50.107314
            ],
            [
              -114.913883,
              50.106466
            ],
            [
              -114.912042,
              50.105402
            ],
            [
              -114.913635,
              50.104421
            ],
            [
              -114.913454,
              50.102403
            ],
            [
              -114.910377,
              50.102504
            ],
            [
              -114.910567,
              50.100673
            ],
            [
              -114.911373,
              50.098071
            ],
            [
              -114.908935,
              50.096768
            ],
            [
              -114.909735,
              50.094682
            ],
            [
              -114.908497,
              50.094179
            ],
            [
              -114.906512,
              50.093917
            ],
            [
              -114.906126,
              50.092632
            ],
            [
              -114.904359,
              50.092838
            ],
            [
              -114.902024,
              50.095417
            ],
            [
              -114.901514,
              50.089869
            ],
            [
              -114.900676,
              50.090006
            ],
            [
              -114.900175,
              50.090233
            ],
            [
              -114.902307,
              50.088569
            ],
            [
              -114.901352,
              50.087124
            ],
            [
              -114.900024,
              50.087865
            ],
            [
              -114.898852,
              50.089655
            ],
            [
              -114.898846,
              50.091752
            ],
            [
              -114.898017,
              50.093325
            ],
            [
              -114.900029,
              50.095214
            ],
            [
              -114.899697,
              50.097103
            ],
            [
              -114.895536,
              50.097509
            ],
            [
              -114.891431,
              50.096562
            ],
            [
              -114.88995,
              50.095308
            ],
            [
              -114.887983,
              50.095618
            ],
            [
              -114.886514,
              50.094681
            ],
            [
              -114.883065,
              50.093435
            ],
            [
              -114.880168,
              50.092508
            ],
            [
              -114.881303,
              50.091059
            ],
            [
              -114.882118,
              50.090019
            ],
            [
              -114.884211,
              50.090331
            ],
            [
              -114.886998,
              50.089067
            ],
            [
              -114.887504,
              50.08708
            ],
            [
              -114.889799,
              50.085815
            ],
            [
              -114.890465,
              50.084761
            ],
            [
              -114.890638,
              50.083291
            ],
            [
              -114.894569,
              50.085476
            ],
            [
              -114.893591,
              50.083906
            ],
            [
              -114.89401,
              50.082648
            ],
            [
              -114.892576,
              50.080436
            ],
            [
              -114.889652,
              50.078228
            ],
            [
              -114.88794,
              50.078753
            ],
            [
              -114.888342,
              50.081075
            ],
            [
              -114.887117,
              50.082862
            ],
            [
              -114.885275,
              50.085136
            ],
            [
              -114.881424,
              50.087487
            ],
            [
              -114.882632,
              50.085586
            ],
            [
              -114.882453,
              50.083312
            ],
            [
              -114.880641,
              50.081496
            ],
            [
              -114.879024,
              50.08095
            ],
            [
              -114.876821,
              50.07939
            ],
            [
              -114.87404,
              50.077741
            ],
            [
              -114.875041,
              50.075201
            ],
            [
              -114.874046,
              50.072901
            ],
            [
              -114.873847,
              50.071239
            ],
            [
              -114.872252,
              50.068935
            ],
            [
              -114.873252,
              50.067271
            ],
            [
              -114.875454,
              50.064447
            ],
            [
              -114.876253,
              50.061068
            ],
            [
              -114.879255,
              50.059168
            ],
            [
              -114.881917,
              50.058229
            ],
            [
              -114.881613,
              50.055021
            ],
            [
              -114.879485,
              50.054583
            ],
            [
              -114.877486,
              50.054107
            ],
            [
              -114.876892,
              50.052019
            ],
            [
              -114.879714,
              50.051144
            ],
            [
              -114.879716,
              50.049814
            ],
            [
              -114.874325,
              50.050459
            ],
            [
              -114.871457,
              50.049023
            ],
            [
              -114.868835,
              50.048364
            ],
            [
              -114.866411,
              50.047702
            ],
            [
              -114.862971,
              50.04677
            ],
            [
              -114.861298,
              50.045891
            ],
            [
              -114.862415,
              50.044273
            ],
            [
              -114.861061,
              50.044568
            ],
            [
              -114.859124,
              50.044417
            ],
            [
              -114.855867,
              50.043706
            ],
            [
              -114.856525,
              50.042648
            ],
            [
              -114.85554,
              50.042225
            ],
            [
              -114.85367,
              50.043255
            ],
            [
              -114.850921,
              50.044457
            ],
            [
              -114.847395,
              50.042258
            ],
            [
              -114.84438,
              50.040533
            ],
            [
              -114.847426,
              50.047091
            ],
            [
              -114.847214,
              50.049762
            ],
            [
              -114.845983,
              50.05323
            ],
            [
              -114.843608,
              50.05762
            ],
            [
              -114.841061,
              50.061746
            ],
            [
              -114.84005,
              50.06457
            ],
            [
              -114.843203,
              50.064309
            ],
            [
              -114.843951,
              50.061983
            ],
            [
              -114.848849,
              50.063416
            ],
            [
              -114.850269,
              50.067269
            ],
            [
              -114.852902,
              50.070469
            ],
            [
              -114.857572,
              50.070745
            ],
            [
              -114.859954,
              50.069139
            ],
            [
              -114.860719,
              50.071871
            ],
            [
              -114.858505,
              50.072895
            ],
            [
              -114.858712,
              50.074681
            ],
            [
              -114.85668,
              50.0754
            ],
            [
              -114.857551,
              50.078118
            ],
            [
              -114.858991,
              50.078251
            ],
            [
              -114.860398,
              50.077556
            ],
            [
              -114.862677,
              50.076455
            ],
            [
              -114.862508,
              50.079394
            ],
            [
              -114.863933,
              50.082123
            ],
            [
              -114.861578,
              50.083059
            ],
            [
              -114.859805,
              50.082735
            ],
            [
              -114.857347,
              50.081799
            ],
            [
              -114.855258,
              50.082823
            ],
            [
              -114.856465,
              50.085025
            ],
            [
              -114.855122,
              50.087706
            ],
            [
              -114.85157,
              50.086567
            ],
            [
              -114.847449,
              50.08622
            ],
            [
              -114.847451,
              50.084985
            ],
            [
              -114.847053,
              50.08237
            ],
            [
              -114.844673,
              50.080308
            ],
            [
              -114.843016,
              50.081763
            ],
            [
              -114.843482,
              50.086172
            ],
            [
              -114.840396,
              50.089759
            ],
            [
              -114.839341,
              50.093131
            ],
            [
              -114.843748,
              50.097052
            ],
            [
              -114.844288,
              50.098991
            ],
            [
              -114.847559,
              50.101451
            ],
            [
              -114.849282,
              50.103165
            ],
            [
              -114.853937,
              50.104065
            ],
            [
              -114.85496,
              50.106277
            ],
            [
              -114.855312,
              50.110619
            ],
            [
              -114.858123,
              50.115941
            ],
            [
              -114.861877,
              50.118619
            ],
            [
              -114.858188,
              50.122699
            ],
            [
              -114.855926,
              50.126647
            ],
            [
              -114.855358,
              50.132821
            ],
            [
              -114.856907,
              50.137465
            ],
            [
              -114.859651,
              50.14081
            ],
            [
              -114.862398,
              50.140994
            ],
            [
              -114.859881,
              50.13798
            ],
            [
              -114.858126,
              50.135127
            ],
            [
              -114.858161,
              50.130466
            ],
            [
              -114.859758,
              50.128409
            ],
            [
              -114.860745,
              50.125164
            ],
            [
              -114.865029,
              50.122367
            ],
            [
              -114.864661,
              50.124911
            ],
            [
              -114.86409,
              50.126864
            ],
            [
              -114.864297,
              50.129386
            ],
            [
              -114.866784,
              50.132117
            ],
            [
              -114.867346,
              50.135688
            ],
            [
              -114.867893,
              50.139189
            ],
            [
              -114.870954,
              50.138908
            ],
            [
              -114.873058,
              50.140983
            ],
            [
              -114.87767,
              50.143522
            ],
            [
              -114.883795,
              50.150064
            ],
            [
              -114.887624,
              50.154564
            ],
            [
              -114.888371,
              50.158324
            ],
            [
              -114.892676,
              50.161048
            ],
            [
              -114.89561,
              50.161117
            ],
            [
              -114.897564,
              50.160353
            ],
            [
              -114.900998,
              50.159271
            ],
            [
              -114.903911,
              50.158874
            ],
            [
              -114.90568,
              50.160158
            ],
            [
              -114.905181,
              50.162544
            ],
            [
              -114.906589,
              50.163671
            ],
            [
              -114.908012,
              50.163454
            ],
            [
              -114.91009,
              50.163806
            ],
            [
              -114.911333,
              50.162651
            ],
            [
              -114.907651,
              50.161569
            ],
            [
              -114.906993,
              50.15988
            ],
            [
              -114.910314,
              50.159553
            ],
            [
              -114.913546,
              50.159196
            ],
            [
              -114.910831,
              50.157517
            ],
            [
              -114.910361,
              50.155475
            ],
            [
              -114.914861,
              50.153428
            ],
            [
              -114.915195,
              50.150441
            ],
            [
              -114.911467,
              50.147982
            ],
            [
              -114.910248,
              50.144601
            ],
            [
              -114.907335,
              50.142976
            ],
            [
              -114.920063,
              50.137813
            ],
            [
              -114.927735,
              50.137479
            ],
            [
              -114.932999,
              50.139118
            ],
            [
              -114.934197,
              50.146173
            ],
            [
              -114.936583,
              50.146049
            ]
          ]
        ]
      },
      "properties": {
        "id": "M0146.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "surface",
        "data source date": "2022-12-31 00:00:00",
        "notes": "The boundary was extracted from the Greenhills permit area shown in Figure 10-1: Drill Collar Location Plan on pg. 10-4 of the NI 43-101 Technical Report on Greenhills Coal Operation, https://web.archive.org/web/20240812193327/https://minedocs.com/24/Greenhills_TR_12312022.pdf, December 31, 2022. The boundary has been simplified by excluding small permitted areas peripheral to the main polygon and small inner boundaries within the main polygon. A portion of the northern permit boundary overlaps with the Fording River Operations coal mine permit boundary, owned by the same company. Page 4-2 states \"Fording River Operations currently maintain the overlapping mineral tenure holdings as there is no mechanism within the Coal Act to subdivide the shared mineral tenure holdings\"; therefore, this overlapping area is excluded from the Greenhills permit boundary here. The approximate boundary area is 36 sq km.",
        "description": "Greenhills Coal Mine permit boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0146",
        "Owners": "Elk Valley Resources [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Glencore [77%]; Nippon Steel Corp [20%]; POSCO [3%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Greenhills_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Greenhills Coal Mine",
        "Country / Area": "Canada",
        "Last researched": "Jul 28, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -114.854056,
          50.060991
        ]
      },
      "properties": {
        "id": "M0146.P1",
        "mine feature category": "other",
        "mine feature subcategory": "preparation plant",
        "data source date": "September 27 2024 (satellite imagery)",
        "notes": "The coal wash plant location was extracted from Figure 10-1: Drill Collar Location Plan on pg. 10-4 of the NI 43-101 Technical Report on Greenhills Coal Operation, https://web.archive.org/web/20240812193327/https://minedocs.com/24/Greenhills_TR_12312022.pdf, December 31, 2022, and visually confirmed with Google Earth Pro satellite imagery.",
        "description": "Coal wash plant at Greenhills Coal Mine",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0146",
        "Owners": "Elk Valley Resources [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Glencore [77%]; Nippon Steel Corp [20%]; POSCO [3%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Greenhills_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Greenhills Coal Mine",
        "Country / Area": "Canada",
        "Last researched": "Jul 28, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(50.040533, -115.0083), L.latLng(50.20028, -114.839341));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleHybrid]}).setView([50.1204065, -114.9238205], 11.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Satellite view": googleHybrid,
        "Street view": googleStreet
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
    GEMMine = L.marker([50.20028, -115.0083], {icon: GEMMineIcon}).addTo(map); 
    GEMMine.bindPopup('Operating status(es): Operating');
    GEMMine.bindTooltip('Greenhills Coal Mine', { permanent: true, direction: 'right'});
