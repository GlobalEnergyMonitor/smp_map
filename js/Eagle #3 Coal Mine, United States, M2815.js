
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -81.483749,
              37.778242
            ],
            [
              -81.486401,
              37.779
            ],
            [
              -81.493814,
              37.779532
            ],
            [
              -81.497549,
              37.780572
            ],
            [
              -81.498722,
              37.782618
            ],
            [
              -81.496619,
              37.780781
            ],
            [
              -81.494508,
              37.780664
            ],
            [
              -81.493385,
              37.781688
            ],
            [
              -81.49724,
              37.785783
            ],
            [
              -81.492188,
              37.788441
            ],
            [
              -81.493281,
              37.789592
            ],
            [
              -81.49409,
              37.789108
            ],
            [
              -81.494822,
              37.789752
            ],
            [
              -81.494028,
              37.789548
            ],
            [
              -81.493131,
              37.790595
            ],
            [
              -81.495137,
              37.792593
            ],
            [
              -81.496813,
              37.791581
            ],
            [
              -81.497905,
              37.792716
            ],
            [
              -81.498478,
              37.792502
            ],
            [
              -81.503327,
              37.789894
            ],
            [
              -81.50329,
              37.789139
            ],
            [
              -81.506453,
              37.792541
            ],
            [
              -81.517289,
              37.78585
            ],
            [
              -81.516842,
              37.785275
            ],
            [
              -81.517525,
              37.785636
            ],
            [
              -81.522999,
              37.782406
            ],
            [
              -81.520279,
              37.779897
            ],
            [
              -81.521497,
              37.778844
            ],
            [
              -81.519925,
              37.777254
            ],
            [
              -81.524491,
              37.774425
            ],
            [
              -81.525026,
              37.773216
            ],
            [
              -81.524084,
              37.77255
            ],
            [
              -81.525821,
              37.771689
            ],
            [
              -81.526253,
              37.770691
            ],
            [
              -81.524023,
              37.770763
            ],
            [
              -81.523299,
              37.770006
            ],
            [
              -81.522617,
              37.770151
            ],
            [
              -81.521501,
              37.771041
            ],
            [
              -81.522313,
              37.772045
            ],
            [
              -81.515754,
              37.775551
            ],
            [
              -81.517056,
              37.777267
            ],
            [
              -81.5158,
              37.777775
            ],
            [
              -81.514675,
              37.7766
            ],
            [
              -81.513878,
              37.776721
            ],
            [
              -81.50797,
              37.780727
            ],
            [
              -81.507247,
              37.781531
            ],
            [
              -81.508459,
              37.782438
            ],
            [
              -81.508136,
              37.783511
            ],
            [
              -81.50955,
              37.784017
            ],
            [
              -81.51117,
              37.782967
            ],
            [
              -81.513744,
              37.785731
            ],
            [
              -81.506579,
              37.789922
            ],
            [
              -81.508288,
              37.78874
            ],
            [
              -81.508095,
              37.788067
            ],
            [
              -81.507385,
              37.787405
            ],
            [
              -81.505345,
              37.78863
            ],
            [
              -81.501692,
              37.785674
            ],
            [
              -81.500863,
              37.784476
            ],
            [
              -81.502808,
              37.786156
            ],
            [
              -81.504313,
              37.785115
            ],
            [
              -81.498808,
              37.77936
            ],
            [
              -81.492213,
              37.778963
            ],
            [
              -81.486831,
              37.777847
            ],
            [
              -81.483891,
              37.777824
            ],
            [
              -81.483749,
              37.778242
            ]
          ]
        ]
      },
      "properties": {
        "id": "M2815.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "underground",
        "data source date": "Unclear - according to https://web.archive.org/web/2/https://www.wvgs.wvnet.edu/www/coal/cbmp/coalims.html, \"Updates to the data set occur as new data becomes available.\"'",
        "notes": "This boundary was extracted from the West Virginia Geological and Economic Survey (WVGES) resource at https://web.archive.org/web/2/https://atlas.wvgs.wvnet.edu/arcgis/rest/services/Coal_Web_Mercator/All_Mining_WM/MapServer. This resource was filtered for mine_name = EAGLE NO. 3 MINE, and the resulting polygon was simplified using distance-based simplification with a tolerance of 50m.  The area of this boundary is 2.5 sq km. Satellite imagery for the area including this boundary was scanned for PPSEs - no additional ones were found. The mine mines the Eagle coal seam. \n\nImportant note: the following mine boundaries overlap the mine boundary and care should be taken when attempting methane source attribution: J & R  NO 1 (Eagle_A seam), EAGLE #1 MINE (Eagle seam), KOPPERSTON NO 2 (Number_2_Gas seam), UNKNOWN (Number_2_Gas seam)",
        "description": "Eagle number 3 coal mine boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2815",
        "Owners": "Rockwell Mining LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Sev.en Global Investments AS [100%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Eagle_3_Coal_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Eagle #3 Coal Mine",
        "Country / Area": "United States",
        "Last researched": "Apr 10, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.483699,
          37.778067
        ]
      },
      "properties": {
        "id": "M2815.P1",
        "mine feature category": "other",
        "mine feature subcategory": "slope access or production shaft",
        "data source date": "Google 4/1/2024, Bing Maps 10/2020 - 3/2021",
        "notes": "Identified visually from Google Earth Pro satellite imagery and checked with Bing Maps satellite imagery due to distortion in GEP imagery.",
        "description": "coal mine production shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2815",
        "Owners": "Rockwell Mining LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Sev.en Global Investments AS [100%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Eagle_3_Coal_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Eagle #3 Coal Mine",
        "Country / Area": "United States",
        "Last researched": "Apr 10, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.48367,
          37.778251
        ]
      },
      "properties": {
        "id": "M2815.P2",
        "mine feature category": "other",
        "mine feature subcategory": "mine entrance or exit",
        "data source date": "Google 4/1/2024, Bing Maps 10/2020 - 3/2021",
        "notes": "Identified visually from Google Earth Pro satellite imagery and checked with Bing Maps satellite imagery due to distortion in GEP imagery.",
        "description": "possible coal mine shaft or entrance",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2815",
        "Owners": "Rockwell Mining LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Sev.en Global Investments AS [100%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Eagle_3_Coal_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Eagle #3 Coal Mine",
        "Country / Area": "United States",
        "Last researched": "Apr 10, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -81.483722,
          37.777793
        ]
      },
      "properties": {
        "id": "M2815.P3",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "shaft",
        "data source date": "Google 4/1/2024, Bing Maps 10/2020 - 3/2021",
        "notes": "Identified visually from Google Earth Pro satellite imagery and checked with Bing Maps satellite imagery due to distortion in GEP imagery.",
        "description": "possible ventilation shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2815",
        "Owners": "Rockwell Mining LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Sev.en Global Investments AS [100%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Eagle_3_Coal_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Eagle #3 Coal Mine",
        "Country / Area": "United States",
        "Last researched": "Apr 10, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(37.770006, -81.526253), L.latLng(37.792716, -81.482806));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleStreet, googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleStreet, googleHybrid]}).setView([37.781361000000004, -81.50452949999999], 12.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Street view": googleStreet,
        "Satellite view": googleHybrid
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
	GEMMine = L.marker([37.778338, -81.482806], {icon: GEMMineIcon}).addTo(map); 
	GEMMine.bindPopup('Operating status(es): Operating');
	GEMMine.bindTooltip('Eagle #3 Coal Mine', { permanent: true, direction: 'right'});
