
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              86.372943,
              23.726327
            ],
            [
              86.372077,
              23.711275
            ],
            [
              86.374984,
              23.709455
            ],
            [
              86.373347,
              23.698987
            ],
            [
              86.378028,
              23.694205
            ],
            [
              86.382808,
              23.691747
            ],
            [
              86.384914,
              23.689748
            ],
            [
              86.387163,
              23.690536
            ],
            [
              86.391366,
              23.693807
            ],
            [
              86.400642,
              23.693232
            ],
            [
              86.407579,
              23.688764
            ],
            [
              86.410336,
              23.684515
            ],
            [
              86.413459,
              23.684304
            ],
            [
              86.414808,
              23.686464
            ],
            [
              86.402359,
              23.712049
            ],
            [
              86.39758,
              23.708696
            ],
            [
              86.3932,
              23.709446
            ],
            [
              86.389238,
              23.709789
            ],
            [
              86.388366,
              23.712157
            ],
            [
              86.385705,
              23.714699
            ],
            [
              86.386623,
              23.719804
            ],
            [
              86.382192,
              23.723833
            ],
            [
              86.372943,
              23.726327
            ]
          ]
        ]
      },
      "properties": {
        "id": "M1686.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "underground",
        "data source date": "2017-09-01 00:00:00",
        "notes": "Jharia Division comprises three collieries: Jamadoba Colliery, 6 & 7 Pits, and Digwadih Colliery, which are interconnected with each other by underground workings/goaves. The boundary of Jamadoba colliery is based on the pre-fesibility report https://web.archive.org/web/20190713202453/https://environmentclearance.nic.in/writereaddata/Online/TOR/20_Sep_2017_164041593UH9ZUCSWAnnexure-Pre-feasibilityreport(PFR)File.pdf released in September 2017, with page 5 of the document listing the latitude and longitude of the mine lease\u2019s corner points. The permitted lease area is 927 ha (9.3 sq km), which is the same as the extracted polygon area.",
        "description": "Jharia Coal Mine-Jamadoba colliery mine boundary",
        "coordinates precision": "reported",
        "GEM Mine ID": "M1686",
        "Owners": "Tata Steel [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Tata Group [50%]; Coal India [50%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Jharia_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Jharia Coal Mine",
        "Country / Area": "India",
        "Last researched": "Apr 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              86.403309,
              23.722077
            ],
            [
              86.40294,
              23.721598
            ],
            [
              86.402186,
              23.721893
            ],
            [
              86.401742,
              23.721734
            ],
            [
              86.40135,
              23.721577
            ],
            [
              86.400743,
              23.721391
            ],
            [
              86.400276,
              23.721228
            ],
            [
              86.399886,
              23.720881
            ],
            [
              86.3999,
              23.720698
            ],
            [
              86.400367,
              23.720285
            ],
            [
              86.400689,
              23.719955
            ],
            [
              86.401451,
              23.719279
            ],
            [
              86.40187,
              23.719055
            ],
            [
              86.402306,
              23.718853
            ],
            [
              86.403242,
              23.719002
            ],
            [
              86.403254,
              23.71899
            ],
            [
              86.403999,
              23.718993
            ],
            [
              86.404649,
              23.719035
            ],
            [
              86.40487,
              23.719383
            ],
            [
              86.405026,
              23.719587
            ],
            [
              86.404849,
              23.719898
            ],
            [
              86.404586,
              23.719909
            ],
            [
              86.404445,
              23.720554
            ],
            [
              86.404446,
              23.720581
            ],
            [
              86.404317,
              23.721246
            ],
            [
              86.404101,
              23.721464
            ],
            [
              86.404372,
              23.721647
            ],
            [
              86.404175,
              23.721762
            ],
            [
              86.403912,
              23.721632
            ],
            [
              86.403309,
              23.722077
            ]
          ]
        ]
      },
      "properties": {
        "id": "M1686.B2",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "surface",
        "data source date": "2022-05-29 00:00:00",
        "notes": "Since the boundary corner points for the 6&7 Colliery are unavailable, the boundary polygon was derived from page 13 of the environmental clearance report https://web.archive.org/web/20230802002813/https://www.tatasteel.com/media/18212/hy_ec_compliance_67_oct22-mar23.pdf, dated May 29, 2022, which lists the green belt in and around the colliery. Although the approved mining lease area is 1.68 sq km, the extracted boundary covers only 0.36 sq km, since the colliery is surrounded by residential dwellings, making it difficult to determine the exact area to include.",
        "description": "Jharia Coal Mine-6&7 Pits mine boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1686",
        "Owners": "Tata Steel [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Tata Group [50%]; Coal India [50%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Jharia_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Jharia Coal Mine",
        "Country / Area": "India",
        "Last researched": "Apr 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              86.411622,
              23.695642
            ],
            [
              86.411429,
              23.69507
            ],
            [
              86.411261,
              23.694571
            ],
            [
              86.411017,
              23.694081
            ],
            [
              86.410657,
              23.693345
            ],
            [
              86.410588,
              23.693211
            ],
            [
              86.411104,
              23.693054
            ],
            [
              86.41188,
              23.693366
            ],
            [
              86.412293,
              23.693843
            ],
            [
              86.412566,
              23.694187
            ],
            [
              86.412925,
              23.694654
            ],
            [
              86.413066,
              23.695084
            ],
            [
              86.411622,
              23.695642
            ]
          ]
        ]
      },
      "properties": {
        "id": "M1686.B3",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "underground",
        "data source date": "2023-11-29 00:00:00",
        "notes": "The boundary data of this colliery is very limited, and the location of the mine is based on the compliance report https://web.archive.org/web/20250327165038/https://www.tatasteel.com/media/19654/hy_ec_compliance_digwadih_colliery_april23-sept23.pdf released in November 29, 2023. The mine lease area is reported to be 3.15 sq km, and the extracted area is only 0.04 sq km, since the colliery is surrounded by residential dwellings, making it difficult to determine the exact area and infrustructure to include.",
        "description": "Jharia Coal Mine-Digwadih colliery mine boundary",
        "coordinates precision": "estimated",
        "GEM Mine ID": "M1686",
        "Owners": "Tata Steel [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Tata Group [50%]; Coal India [50%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Jharia_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Jharia Coal Mine",
        "Country / Area": "India",
        "Last researched": "Apr 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          86.399302,
          23.707613
        ]
      },
      "properties": {
        "id": "M1686.P1",
        "mine feature category": "degasification system",
        "mine feature subcategory": "drainage station",
        "data source date": "2024",
        "notes": "Due to the lack of documented drainage system details, the location has been estimated by examining the appearance of such infrastructure in satellite imagery. However, the imagery for this mine is rather blurry, and the numerous residential dwellings both within and surrounding the colliery make it challenging to clearly identify the infrastructure.",
        "description": "Jharia Coal Mine-Jamadoba colliery gas drainage station",
        "coordinates precision": "estimated",
        "GEM Mine ID": "M1686",
        "Owners": "Tata Steel [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Tata Group [50%]; Coal India [50%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Jharia_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Jharia Coal Mine",
        "Country / Area": "India",
        "Last researched": "Apr 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          86.396069,
          23.701683
        ]
      },
      "properties": {
        "id": "M1686.P2",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "shaft",
        "data source date": "2024-06-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "Possible drainage station or venting shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1686",
        "Owners": "Tata Steel [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Tata Group [50%]; Coal India [50%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Jharia_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Jharia Coal Mine",
        "Country / Area": "India",
        "Last researched": "Apr 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          86.393463,
          23.697205
        ]
      },
      "properties": {
        "id": "M1686.P3",
        "mine feature category": "degasification system",
        "mine feature subcategory": "flare",
        "data source date": "2025-03-01 00:00:00",
        "notes": "Identified visually from Google Earth Pro satellite imagery.",
        "description": "Possible flare",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M1686",
        "Owners": "Tata Steel [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Tata Group [50%]; Coal India [50%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Jharia_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Jharia Coal Mine",
        "Country / Area": "India",
        "Last researched": "Apr 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(23.684304, 86.372077), L.latLng(23.726327, 86.414808));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleHybrid]}).setView([23.7053155, 86.39344249999999], 12.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Satellite view": googleHybrid,
        "Street view": googleStreet
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
    GEMMine = L.marker([23.708161, 86.400024], {icon: GEMMineIcon}).addTo(map); 
    GEMMine.bindPopup('Operating status(es): Operating');
    GEMMine.bindTooltip('Jharia Coal Mine', { permanent: true, direction: 'right'});
