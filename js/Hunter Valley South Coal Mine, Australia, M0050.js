
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              150.98707,
              -32.518229
            ],
            [
              150.981616,
              -32.519128
            ],
            [
              150.977729,
              -32.517806
            ],
            [
              150.97704,
              -32.516115
            ],
            [
              150.971523,
              -32.515216
            ],
            [
              150.968013,
              -32.515798
            ],
            [
              150.967888,
              -32.517383
            ],
            [
              150.964252,
              -32.5177
            ],
            [
              150.960804,
              -32.517647
            ],
            [
              150.958294,
              -32.531391
            ],
            [
              150.966821,
              -32.532237
            ],
            [
              150.965754,
              -32.53895
            ],
            [
              150.982683,
              -32.540338
            ],
            [
              150.986696,
              -32.540444
            ],
            [
              150.989142,
              -32.540655
            ],
            [
              150.991839,
              -32.541025
            ],
            [
              150.993658,
              -32.541923
            ],
            [
              150.996292,
              -32.543773
            ],
            [
              150.998236,
              -32.5452
            ],
            [
              151.002751,
              -32.545781
            ],
            [
              151.008081,
              -32.545885
            ],
            [
              151.014226,
              -32.545566
            ],
            [
              151.01548,
              -32.545302
            ],
            [
              151.033241,
              -32.550411
            ],
            [
              151.032993,
              -32.554376
            ],
            [
              151.031362,
              -32.554482
            ],
            [
              151.029544,
              -32.554959
            ],
            [
              151.028604,
              -32.555541
            ],
            [
              151.028667,
              -32.556915
            ],
            [
              151.029672,
              -32.558712
            ],
            [
              151.03168,
              -32.560561
            ],
            [
              151.034691,
              -32.561405
            ],
            [
              151.038204,
              -32.563148
            ],
            [
              151.056161,
              -32.581852
            ],
            [
              151.057856,
              -32.581956
            ],
            [
              151.059926,
              -32.581638
            ],
            [
              151.060553,
              -32.581268
            ],
            [
              151.061557,
              -32.580421
            ],
            [
              151.061805,
              -32.577188
            ],
            [
              151.061865,
              -32.574914
            ],
            [
              151.061361,
              -32.573276
            ],
            [
              151.059352,
              -32.571797
            ],
            [
              151.057091,
              -32.570265
            ],
            [
              151.055395,
              -32.567676
            ],
            [
              151.053573,
              -32.565351
            ],
            [
              151.051877,
              -32.561969
            ],
            [
              151.049115,
              -32.559856
            ],
            [
              151.045977,
              -32.557532
            ],
            [
              151.04215,
              -32.556318
            ],
            [
              151.037634,
              -32.555581
            ],
            [
              151.037571,
              -32.554841
            ],
            [
              151.038197,
              -32.552779
            ],
            [
              151.037819,
              -32.549777
            ],
            [
              151.036186,
              -32.546341
            ],
            [
              151.036184,
              -32.544333
            ],
            [
              151.03637,
              -32.540633
            ],
            [
              151.037811,
              -32.539099
            ],
            [
              151.040318,
              -32.538146
            ],
            [
              151.047592,
              -32.538512
            ],
            [
              151.04784,
              -32.534442
            ],
            [
              151.046272,
              -32.533756
            ],
            [
              151.046209,
              -32.531963
            ],
            [
              151.046647,
              -32.531275
            ],
            [
              151.047836,
              -32.529001
            ],
            [
              151.048023,
              -32.526939
            ],
            [
              151.04846,
              -32.525089
            ],
            [
              151.049337,
              -32.524348
            ],
            [
              151.050653,
              -32.523872
            ],
            [
              151.052279,
              -32.519589
            ],
            [
              151.049959,
              -32.518903
            ],
            [
              151.049293,
              -32.51716
            ],
            [
              151.047599,
              -32.516156
            ],
            [
              151.047472,
              -32.513777
            ],
            [
              151.045651,
              -32.510131
            ],
            [
              151.045772,
              -32.504897
            ],
            [
              151.042951,
              -32.504106
            ],
            [
              151.038688,
              -32.504161
            ],
            [
              151.034927,
              -32.505379
            ],
            [
              151.029724,
              -32.504641
            ],
            [
              151.026839,
              -32.502105
            ],
            [
              151.025773,
              -32.499938
            ],
            [
              151.024832,
              -32.498934
            ],
            [
              151.021949,
              -32.4992
            ],
            [
              151.017124,
              -32.501686
            ],
            [
              151.00449,
              -32.511645
            ],
            [
              150.995966,
              -32.516405
            ],
            [
              150.99233,
              -32.517727
            ],
            [
              150.989259,
              -32.51815
            ],
            [
              150.98707,
              -32.518229
            ]
          ]
        ]
      },
      "properties": {
        "id": "M0050.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "surface",
        "data source date": "2024-03-28 00:00:00",
        "notes": "Page 12 of the 2022 Independent Environmental Audit Hunter Valley Operations,  https://web.archive.org/web/2/https://www.hvo.com.au/wp-content/uploads/2023/08/Hunter-Valley-Operations-Independent-Environmental-Audit-2022-and-Response-to-Recommendations.pdf, describes Hunter Valley North and Hunter Valley South 'development consents': DA 450-10-2003 that covers HVO North and PA 06_0261 that cover HVO South. Page 17 has a diagram of the boundaries for the consents. Section '2.2 Background' on page 20 of 2023 Annual Environmental Review published 3/2024, https://web.archive.org/web/2/https://www.hvo.com.au/wp-content/uploads/2024/04/HVO-Annual-Review-2023.pdf, refers to HVO North and HVO South by the above consents. Page 22 contains a diagram 'Hunter Valley Operations Site Overview' which includes the environmental protection license EPL 640 area of the mines within the consents. The boundary is the boundary of EPL 640 within consent PA 06_0261. The area of the boundary is approximately 33 sq km.",
        "description": "Hunter Valley South coal mine boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0050",
        "Owners": "Hunter Valley Operations [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Yancoal Australia Ltd [51%]; Glencore PLC [49%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Hunter_Valley_South_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Thermal & Met",
        "Mine Name": "Hunter Valley South Coal Mine",
        "Country / Area": "Australia",
        "Last researched": "Jul 14, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(-32.581956, 150.958294), L.latLng(-32.498934, 151.061865));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleHybrid]}).setView([-32.540445, 151.01007950000002], 12.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Satellite view": googleHybrid,
        "Street view": googleStreet
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
	GEMMine = L.marker([-32.5245107, 150.9819012], {icon: GEMMineIcon}).addTo(map); 
	GEMMine.bindPopup('Operating status(es): Operating');
	GEMMine.bindTooltip('Hunter Valley South Coal Mine', { permanent: true, direction: 'right'});
