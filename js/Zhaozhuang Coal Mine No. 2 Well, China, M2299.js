
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              112.887736,
              36.017203
            ],
            [
              112.887762,
              36.000898
            ],
            [
              112.894956,
              36.000899
            ],
            [
              112.904329,
              35.997951
            ],
            [
              112.904251,
              36.000614
            ],
            [
              112.933415,
              36.000726
            ],
            [
              112.933275,
              36.00471
            ],
            [
              112.937743,
              36.004707
            ],
            [
              112.937624,
              36.000725
            ],
            [
              112.962344,
              36.000611
            ],
            [
              112.962613,
              36.004823
            ],
            [
              112.966803,
              36.004756
            ],
            [
              112.966709,
              36.017241
            ],
            [
              112.887736,
              36.017203
            ]
          ]
        ]
      },
      "properties": {
        "id": "M2299.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "underground",
        "data source date": "2024-11-01 00:00:00",
        "notes": "The boundary coordinates were found in Table 2.2-1 on page 22 and included both Zhaozhuang coal mine main site and the No.2 Well from the document Zhaozhuang Mine Capacity Expansion Project of Shanxi Jincheng Anthracite Mining Group Co., Ltd (\u5c71\u897f\u664b\u57ce\u65e0\u70df\u7164\u77ff\u4e1a\u96c6\u56e2\u6709\u9650\u8d23\u4efb\u516c\u53f8\u8d75\u5e84\u77ff\u4e95\u6269\u80fd\u5de5\u7a0b), \nhttps://web.archive.org/web/20250704064246/https://www.doc88.com/p-44959000572479.html.  The No.2 Well boundary was extracted from Figure 3.1-1 Sanyuan Coal Mine Adjacent Relationship Map on page 57 in the document Shanxi Sanyuan Coal Mine Environmental Assessment Report (\u5c71\u897f\u4e09\u5143\u7164\u4e1a\u80a1\u4efd\u6709\u9650\u516c\u53f8\u4e0b\u970d\u7164\u77ff2305\u5de5\u4f5c\u9762\u79bb\u5c42\u533a\u5145\u586b\u5f00\u91c7\uff08\u8bd5\u9a8c\uff09\u9879\u76ee\u73af\u5883\u5f71\u54cd\u62a5\u544a\u4e66), https://web.archive.org/web/20250716071739/http://www.zhangzi.gov.cn/zzxxgk/zfxxgk/bmxxgk/SCZ/zzhbj/hbgknr/HB/hjbhlyxzxk/202411/P020241112361033027090.pdf ",
        "description": "Zhaozhuang coal mine No.2 well boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2299",
        "Owners": "Shanxi Jinmei Group Zhaozhuang Coal Industry Company No. 2 Well [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Jinneng Group",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Zhaozhuang_Coal_Mine_No._2_Well",
        "GEM Wiki Page (Non-ENG)": "https://www.gem.wiki/%E5%B1%B1%E8%A5%BF%E6%99%8B%E7%85%A4%E9%9B%86%E5%9B%A2%E8%B5%B5%E5%BA%84%E7%85%A4%E4%B8%9A%E6%9C%89%E9%99%90%E8%B4%A3%E4%BB%BB%E5%85%AC%E5%8F%B8%E4%BA%8C%E5%8F%B7%E4%BA%95",
        "Coal Grade": "Thermal",
        "Mine Name": "Zhaozhuang Coal Mine No. 2 Well",
        "Country / Area": "China",
        "Last researched": "Jul 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          112.909419,
          36.009207
        ]
      },
      "properties": {
        "id": "M2299.P1",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "shaft",
        "data source date": "2024-08-19 00:00:00",
        "notes": "Information about the shaft location was found in document Site Selection Study Report for the New West Ventilation Shaft Project of Zhaozhuang No.2 Well, Shanxi Jincheng Anthracite Mining Group Zhaozhuang Coal Industry Co., Ltd (\u65b0\u5efa\u5c71\u897f\u664b\u7164\u96c6\u56e2\u8d75\u5e84\u7164\u4e1a\u6709\u9650\u8d23\u4efb\u516c\u53f8\u8d75\u5e84\u4e8c\u53f7\u4e95\u897f\u98ce\u4e95\u9879\u76ee\u9009\u5740\u7814\u7a76\u62a5\u544a) https://web.archive.org/web/20250704070314/http://www.zhangzi.gov.cn/zzxxgk/zfxxgk/bmxxgk/xzfgzbm/gtzyj/zrgknr/TZGG/202001/W020200108605893371448.pdf . The location was then identified visually from Google Earth Pro satellite imagery.",
        "description": "West return air shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2299",
        "Owners": "Shanxi Jinmei Group Zhaozhuang Coal Industry Company No. 2 Well [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Jinneng Group",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Zhaozhuang_Coal_Mine_No._2_Well",
        "GEM Wiki Page (Non-ENG)": "https://www.gem.wiki/%E5%B1%B1%E8%A5%BF%E6%99%8B%E7%85%A4%E9%9B%86%E5%9B%A2%E8%B5%B5%E5%BA%84%E7%85%A4%E4%B8%9A%E6%9C%89%E9%99%90%E8%B4%A3%E4%BB%BB%E5%85%AC%E5%8F%B8%E4%BA%8C%E5%8F%B7%E4%BA%95",
        "Coal Grade": "Thermal",
        "Mine Name": "Zhaozhuang Coal Mine No. 2 Well",
        "Country / Area": "China",
        "Last researched": "Jul 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          112.930638,
          36.012699
        ]
      },
      "properties": {
        "id": "M2299.P2",
        "mine feature category": "other",
        "mine feature subcategory": "slope access or production shaft",
        "data source date": "2024-08-19 00:00:00",
        "notes": "The shaft was described on page 9 of Geological Report for the Construction of Zhaozhuang No.2 Mine Shaft (\u8d75\u5e84\u4e8c\u53f7\u4e95\u5efa\u4e95\u5730\u8d28\u62a5\u544a) https://web.archive.org/web/20250704064739/https://www.doc88.com/p-2751545921588.html. The location was identified visually from Google Earth Pro satellite imagery. ",
        "description": "Main shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2299",
        "Owners": "Shanxi Jinmei Group Zhaozhuang Coal Industry Company No. 2 Well [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Jinneng Group",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Zhaozhuang_Coal_Mine_No._2_Well",
        "GEM Wiki Page (Non-ENG)": "https://www.gem.wiki/%E5%B1%B1%E8%A5%BF%E6%99%8B%E7%85%A4%E9%9B%86%E5%9B%A2%E8%B5%B5%E5%BA%84%E7%85%A4%E4%B8%9A%E6%9C%89%E9%99%90%E8%B4%A3%E4%BB%BB%E5%85%AC%E5%8F%B8%E4%BA%8C%E5%8F%B7%E4%BA%95",
        "Coal Grade": "Thermal",
        "Mine Name": "Zhaozhuang Coal Mine No. 2 Well",
        "Country / Area": "China",
        "Last researched": "Jul 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          112.941148,
          36.008823
        ]
      },
      "properties": {
        "id": "M2299.P3",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "shaft",
        "data source date": "2024-08-19 00:00:00",
        "notes": "The shaft was described on page 9 of Geological Report for the Construction of Zhaozhuang No.2 Mine Shaft (\u8d75\u5e84\u4e8c\u53f7\u4e95\u5efa\u4e95\u5730\u8d28\u62a5\u544a) https://web.archive.org/web/20250704064739/https://www.doc88.com/p-2751545921588.html. The location was identified visually from Google Earth Pro satellite imagery. ",
        "description": "East return air shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2299",
        "Owners": "Shanxi Jinmei Group Zhaozhuang Coal Industry Company No. 2 Well [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Jinneng Group",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Zhaozhuang_Coal_Mine_No._2_Well",
        "GEM Wiki Page (Non-ENG)": "https://www.gem.wiki/%E5%B1%B1%E8%A5%BF%E6%99%8B%E7%85%A4%E9%9B%86%E5%9B%A2%E8%B5%B5%E5%BA%84%E7%85%A4%E4%B8%9A%E6%9C%89%E9%99%90%E8%B4%A3%E4%BB%BB%E5%85%AC%E5%8F%B8%E4%BA%8C%E5%8F%B7%E4%BA%95",
        "Coal Grade": "Thermal",
        "Mine Name": "Zhaozhuang Coal Mine No. 2 Well",
        "Country / Area": "China",
        "Last researched": "Jul 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          112.931,
          36.012256
        ]
      },
      "properties": {
        "id": "M2299.P4",
        "mine feature category": "other",
        "mine feature subcategory": "slope access or production shaft",
        "data source date": "2024-08-19 00:00:00",
        "notes": "The shaft was described on page 10 of Geological Report for the Construction of Zhaozhuang No.2 Mine Shaft (\u8d75\u5e84\u4e8c\u53f7\u4e95\u5efa\u4e95\u5730\u8d28\u62a5\u544a) https://web.archive.org/web/20250704064739/https://www.doc88.com/p-2751545921588.html. The location was identified visually from Google Earth Pro satellite imagery. ",
        "description": "Auxiliary shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2299",
        "Owners": "Shanxi Jinmei Group Zhaozhuang Coal Industry Company No. 2 Well [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Jinneng Group",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Zhaozhuang_Coal_Mine_No._2_Well",
        "GEM Wiki Page (Non-ENG)": "https://www.gem.wiki/%E5%B1%B1%E8%A5%BF%E6%99%8B%E7%85%A4%E9%9B%86%E5%9B%A2%E8%B5%B5%E5%BA%84%E7%85%A4%E4%B8%9A%E6%9C%89%E9%99%90%E8%B4%A3%E4%BB%BB%E5%85%AC%E5%8F%B8%E4%BA%8C%E5%8F%B7%E4%BA%95",
        "Coal Grade": "Thermal",
        "Mine Name": "Zhaozhuang Coal Mine No. 2 Well",
        "Country / Area": "China",
        "Last researched": "Jul 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          112.910252,
          36.009691
        ]
      },
      "properties": {
        "id": "M2299.P5",
        "mine feature category": "degasification system",
        "mine feature subcategory": "drainage station",
        "data source date": "2024-08-19 00:00:00",
        "notes": "The gas drainage station was referred to in Environmental Protection Completion Acceptance Report for the Surface Gas Drainage System Project of Zhaozhuang No.2 Mine, Shanxi Jincheng Anthracite Mining Group Zhaozhuang Coal Industry Co., Ltd (\u5c71\u897f\u664b\u7164\u96c6\u56e2\u8d75\u5e84\u7164\u4e1a\u6709\u9650\u8d23\u4efb\u516c\u53f8\u8d75\u5e84\u4e8c\u53f7\u4e95\u5730\u9762\u74e6\u65af\u62bd\u91c7\u7cfb\u7edf\u5de5\u7a0b\u7ae3\u5de5\u73af\u5883\u4fdd\u62a4\u9a8c\u6536\u610f\u89c1),  https://web.archive.org/web/20250704070520/http://120.132.31.73:8088/czlanlang/d/file/xinxigongkai/2023-03-02/16ceea3045ae41b36e6d2c9d58ef5f53.pdf. The location was identified visually from Google Earth Pro satellite imagery. \n",
        "description": "No.2 well gas drainage station",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2299",
        "Owners": "Shanxi Jinmei Group Zhaozhuang Coal Industry Company No. 2 Well [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Jinneng Group",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Zhaozhuang_Coal_Mine_No._2_Well",
        "GEM Wiki Page (Non-ENG)": "https://www.gem.wiki/%E5%B1%B1%E8%A5%BF%E6%99%8B%E7%85%A4%E9%9B%86%E5%9B%A2%E8%B5%B5%E5%BA%84%E7%85%A4%E4%B8%9A%E6%9C%89%E9%99%90%E8%B4%A3%E4%BB%BB%E5%85%AC%E5%8F%B8%E4%BA%8C%E5%8F%B7%E4%BA%95",
        "Coal Grade": "Thermal",
        "Mine Name": "Zhaozhuang Coal Mine No. 2 Well",
        "Country / Area": "China",
        "Last researched": "Jul 15, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(35.997951, 112.887736), L.latLng(36.017241, 112.966803));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleHybrid]}).setView([36.007596, 112.9272695], 12.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Satellite view": googleHybrid,
        "Street view": googleStreet
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
    GEMMine = L.marker([36.012508, 112.930231], {icon: GEMMineIcon}).addTo(map); 
    GEMMine.bindPopup('Operating status(es): Operating');
    GEMMine.bindTooltip('Zhaozhuang Coal Mine No. 2 Well', { permanent: true, direction: 'right'});
