
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              -79.320347,
              40.661983
            ],
            [
              -79.320584,
              40.662654
            ],
            [
              -79.320774,
              40.662755
            ],
            [
              -79.326761,
              40.662454
            ],
            [
              -79.327335,
              40.661525
            ],
            [
              -79.327606,
              40.661444
            ],
            [
              -79.328662,
              40.661468
            ],
            [
              -79.329148,
              40.659659
            ],
            [
              -79.330629,
              40.658212
            ],
            [
              -79.333225,
              40.656388
            ],
            [
              -79.334648,
              40.655344
            ],
            [
              -79.335681,
              40.655109
            ],
            [
              -79.336434,
              40.654515
            ],
            [
              -79.336972,
              40.654223
            ],
            [
              -79.337875,
              40.654249
            ],
            [
              -79.34007,
              40.654219
            ],
            [
              -79.343265,
              40.653955
            ],
            [
              -79.345817,
              40.653842
            ],
            [
              -79.346034,
              40.653683
            ],
            [
              -79.346059,
              40.653307
            ],
            [
              -79.346003,
              40.652348
            ],
            [
              -79.345817,
              40.651702
            ],
            [
              -79.345995,
              40.651311
            ],
            [
              -79.346652,
              40.650277
            ],
            [
              -79.347134,
              40.649817
            ],
            [
              -79.347322,
              40.649814
            ],
            [
              -79.349216,
              40.650734
            ],
            [
              -79.34932,
              40.651498
            ],
            [
              -79.350926,
              40.651748
            ],
            [
              -79.351622,
              40.651674
            ],
            [
              -79.352629,
              40.651764
            ],
            [
              -79.353631,
              40.651659
            ],
            [
              -79.354101,
              40.65138
            ],
            [
              -79.354286,
              40.650574
            ],
            [
              -79.354313,
              40.649549
            ],
            [
              -79.354107,
              40.648774
            ],
            [
              -79.353923,
              40.648167
            ],
            [
              -79.35359,
              40.647782
            ],
            [
              -79.353093,
              40.647646
            ],
            [
              -79.352672,
              40.647147
            ],
            [
              -79.352672,
              40.64572
            ],
            [
              -79.35143,
              40.645024
            ],
            [
              -79.350339,
              40.644248
            ],
            [
              -79.349808,
              40.643386
            ],
            [
              -79.350302,
              40.642705
            ],
            [
              -79.348063,
              40.642321
            ],
            [
              -79.349905,
              40.639598
            ],
            [
              -79.347865,
              40.638291
            ],
            [
              -79.347855,
              40.637876
            ],
            [
              -79.348237,
              40.637469
            ],
            [
              -79.348529,
              40.636868
            ],
            [
              -79.348482,
              40.636311
            ],
            [
              -79.348301,
              40.635873
            ],
            [
              -79.348097,
              40.635175
            ],
            [
              -79.347591,
              40.634625
            ],
            [
              -79.346643,
              40.634158
            ],
            [
              -79.345197,
              40.633439
            ],
            [
              -79.344373,
              40.633178
            ],
            [
              -79.344044,
              40.63291
            ],
            [
              -79.343251,
              40.632519
            ],
            [
              -79.3424,
              40.632518
            ],
            [
              -79.341505,
              40.632828
            ],
            [
              -79.341117,
              40.632963
            ],
            [
              -79.340786,
              40.633357
            ],
            [
              -79.335643,
              40.631093
            ],
            [
              -79.337988,
              40.6266
            ],
            [
              -79.339451,
              40.624579
            ],
            [
              -79.339531,
              40.624206
            ],
            [
              -79.337242,
              40.623822
            ],
            [
              -79.336603,
              40.624168
            ],
            [
              -79.33119,
              40.624125
            ],
            [
              -79.328317,
              40.624285
            ],
            [
              -79.329703,
              40.621738
            ],
            [
              -79.327241,
              40.62241
            ],
            [
              -79.328529,
              40.619769
            ],
            [
              -79.326329,
              40.614772
            ],
            [
              -79.327489,
              40.614136
            ],
            [
              -79.326136,
              40.613498
            ],
            [
              -79.314427,
              40.614233
            ],
            [
              -79.309603,
              40.614378
            ],
            [
              -79.30835,
              40.615556
            ],
            [
              -79.298318,
              40.607277
            ],
            [
              -79.289947,
              40.61355
            ],
            [
              -79.287667,
              40.620673
            ],
            [
              -79.285453,
              40.627652
            ],
            [
              -79.284617,
              40.62977
            ],
            [
              -79.28323,
              40.634625
            ],
            [
              -79.284,
              40.634822
            ],
            [
              -79.284087,
              40.635638
            ],
            [
              -79.284141,
              40.63578
            ],
            [
              -79.284892,
              40.635861
            ],
            [
              -79.284998,
              40.636041
            ],
            [
              -79.285143,
              40.636389
            ],
            [
              -79.285051,
              40.636832
            ],
            [
              -79.285209,
              40.637063
            ],
            [
              -79.285622,
              40.637239
            ],
            [
              -79.286163,
              40.637089
            ],
            [
              -79.286356,
              40.637333
            ],
            [
              -79.286582,
              40.637563
            ],
            [
              -79.286502,
              40.637772
            ],
            [
              -79.28697,
              40.638155
            ],
            [
              -79.28628,
              40.639979
            ],
            [
              -79.286168,
              40.640305
            ],
            [
              -79.286344,
              40.640549
            ],
            [
              -79.286796,
              40.640971
            ],
            [
              -79.286512,
              40.641182
            ],
            [
              -79.286499,
              40.642842
            ],
            [
              -79.285749,
              40.643553
            ],
            [
              -79.285893,
              40.643927
            ],
            [
              -79.286039,
              40.644353
            ],
            [
              -79.288687,
              40.644758
            ],
            [
              -79.288957,
              40.644625
            ],
            [
              -79.289224,
              40.644401
            ],
            [
              -79.289584,
              40.644526
            ],
            [
              -79.289661,
              40.644914
            ],
            [
              -79.289737,
              40.64525
            ],
            [
              -79.290323,
              40.645541
            ],
            [
              -79.289833,
              40.647207
            ],
            [
              -79.289858,
              40.64757
            ],
            [
              -79.290118,
              40.647735
            ],
            [
              -79.290107,
              40.64802
            ],
            [
              -79.289546,
              40.648067
            ],
            [
              -79.288803,
              40.64831
            ],
            [
              -79.288521,
              40.64939
            ],
            [
              -79.286948,
              40.649087
            ],
            [
              -79.28674,
              40.648934
            ],
            [
              -79.283715,
              40.648429
            ],
            [
              -79.283223,
              40.648527
            ],
            [
              -79.282533,
              40.649612
            ],
            [
              -79.281505,
              40.64934
            ],
            [
              -79.281055,
              40.65124
            ],
            [
              -79.281451,
              40.651442
            ],
            [
              -79.280812,
              40.655548
            ],
            [
              -79.280925,
              40.656001
            ],
            [
              -79.281275,
              40.656411
            ],
            [
              -79.281654,
              40.656626
            ],
            [
              -79.282012,
              40.656622
            ],
            [
              -79.282315,
              40.656488
            ],
            [
              -79.282601,
              40.656316
            ],
            [
              -79.283164,
              40.656386
            ],
            [
              -79.283512,
              40.656719
            ],
            [
              -79.28364,
              40.657106
            ],
            [
              -79.283987,
              40.657387
            ],
            [
              -79.28447,
              40.656913
            ],
            [
              -79.284475,
              40.656382
            ],
            [
              -79.284532,
              40.655888
            ],
            [
              -79.285127,
              40.655867
            ],
            [
              -79.285624,
              40.655977
            ],
            [
              -79.285961,
              40.656569
            ],
            [
              -79.286412,
              40.656939
            ],
            [
              -79.286892,
              40.657063
            ],
            [
              -79.287362,
              40.656784
            ],
            [
              -79.288857,
              40.655896
            ],
            [
              -79.289463,
              40.655589
            ],
            [
              -79.291612,
              40.654977
            ],
            [
              -79.292049,
              40.653999
            ],
            [
              -79.294916,
              40.652793
            ],
            [
              -79.296117,
              40.652479
            ],
            [
              -79.297003,
              40.65248
            ],
            [
              -79.298139,
              40.65301
            ],
            [
              -79.299534,
              40.652978
            ],
            [
              -79.300989,
              40.653322
            ],
            [
              -79.304834,
              40.657576
            ],
            [
              -79.305637,
              40.658447
            ],
            [
              -79.310523,
              40.659872
            ],
            [
              -79.311259,
              40.660031
            ],
            [
              -79.311735,
              40.659999
            ],
            [
              -79.31202,
              40.659787
            ],
            [
              -79.312219,
              40.659577
            ],
            [
              -79.312334,
              40.659381
            ],
            [
              -79.312327,
              40.659096
            ],
            [
              -79.312371,
              40.658771
            ],
            [
              -79.312399,
              40.658511
            ],
            [
              -79.312992,
              40.6584
            ],
            [
              -79.313487,
              40.658458
            ],
            [
              -79.313796,
              40.658557
            ],
            [
              -79.314044,
              40.658956
            ],
            [
              -79.314191,
              40.659434
            ],
            [
              -79.314452,
              40.659664
            ],
            [
              -79.314778,
              40.65975
            ],
            [
              -79.315103,
              40.659837
            ],
            [
              -79.315666,
              40.659855
            ],
            [
              -79.316258,
              40.659691
            ],
            [
              -79.316609,
              40.65944
            ],
            [
              -79.316916,
              40.659449
            ],
            [
              -79.317282,
              40.659794
            ],
            [
              -79.317324,
              40.660157
            ],
            [
              -79.317436,
              40.660557
            ],
            [
              -79.31766,
              40.660671
            ],
            [
              -79.31809,
              40.66086
            ],
            [
              -79.318392,
              40.6614
            ],
            [
              -79.318534,
              40.661645
            ],
            [
              -79.318882,
              40.661951
            ],
            [
              -79.319275,
              40.662011
            ],
            [
              -79.319662,
              40.661824
            ],
            [
              -79.32007,
              40.661779
            ],
            [
              -79.320347,
              40.661983
            ]
          ]
        ]
      },
      "properties": {
        "id": "M2714.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "underground",
        "data source date": "First published July 8, 2016 and last updated May 8, 2025",
        "notes": "The boundary is for permit 03981301 boundary extracted from the PA Department of Environmental Protection GIS, https://web.archive.org/web/20250326164532/https://pa-geo-data-pennmap.hub.arcgis.com/datasets/PADEP-1::bituminous-mining-permits-section-active-underground-mine-permit-boundaries/explore?location=40.504664%2C-79.539200%2C8.79 first published July 2016 and updated May 2025 - Bituminous_Mining_Permits_Section_-_Active_Underground_Mine_Permit_Boundaries shapefile, filtered with \"MINE\" = 'Parkwood Mine'. The area of the boundary is 23 sq km.",
        "description": "Parkwood Mine permit boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2714",
        "Owners": "Rosebud Mining Co [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "natural persons [100%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Parkwood_Coal_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Parkwood Coal Mine",
        "Country / Area": "United States",
        "Last researched": "Apr 04, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -79.327087,
          40.661051
        ]
      },
      "properties": {
        "id": "M2714.P1",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "shaft",
        "data source date": "2024-09-11 00:00:00",
        "notes": "Coordinates of the shaft located at mine mouth were extracted manually from Google Earth Pro satellite imagery",
        "description": "Ventilation shaft at Parkwood Mine",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M2714",
        "Owners": "Rosebud Mining Co [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "natural persons [100%]",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Parkwood_Coal_Mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Parkwood Coal Mine",
        "Country / Area": "United States",
        "Last researched": "Apr 04, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(40.607277, -79.354313), L.latLng(40.662755, -79.280812));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleHybrid]}).setView([40.635016, -79.31756250000001], 12.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Satellite view": googleHybrid,
        "Street view": googleStreet
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
    GEMMine = L.marker([40.661111, -79.328056], {icon: GEMMineIcon}).addTo(map); 
    GEMMine.bindPopup('Operating status(es): Operating');
    GEMMine.bindTooltip('Parkwood Coal Mine', { permanent: true, direction: 'right'});
