
    var mine = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              94.218267,
              51.385296
            ],
            [
              94.218019,
              51.385035
            ],
            [
              94.188761,
              51.391422
            ],
            [
              94.152647,
              51.415867
            ],
            [
              94.140147,
              51.421422
            ],
            [
              94.081814,
              51.404756
            ],
            [
              94.16265,
              51.366144
            ],
            [
              94.277653,
              51.330033
            ],
            [
              94.272653,
              51.350589
            ],
            [
              94.278282,
              51.354341
            ],
            [
              94.278671,
              51.35443
            ],
            [
              94.335989,
              51.339478
            ],
            [
              94.437381,
              51.465039
            ],
            [
              94.380989,
              51.478925
            ],
            [
              94.328489,
              51.412814
            ],
            [
              94.304597,
              51.416425
            ],
            [
              94.284042,
              51.423092
            ],
            [
              94.25265,
              51.427258
            ],
            [
              94.218206,
              51.385311
            ],
            [
              94.218267,
              51.385296
            ]
          ]
        ]
      },
      "properties": {
        "id": "M0820.B1",
        "mine feature category": "mine boundary",
        "mine feature subcategory": "underground",
        "data source date": "2025-12-24 00:00:00",
        "notes": "\"This mine operates under two adjacent subsoil land-use licenses \u041a\u0417\u041b 14886 \u0422\u042d and \u041a\u0417\u041b 15045 \u0422\u042d, as identified through the Official Portal of the Ministry of Economy of the Republic of Tuva: Construction of a Coal Mining Complex at the Mezhegeyskoye Deposit of the Ulug-Khem Coal Basin\n(\u041e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0439 \u043f\u043e\u0440\u0442\u0430\u043b \u041c\u0438\u043d\u0438\u0441\u0442\u0435\u0440\u0441\u0442\u0432\u0430 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u043a\u0438 \u0420\u0435\u0441\u043f\u0443\u0431\u043b\u0438\u043a\u0438 \u0422\u044b\u0432\u0430: \u0421\u0442\u0440\u043e\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e \u0443\u0433\u043b\u0435\u0434\u043e\u0431\u044b\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u043a\u043e\u043c\u043f\u043b\u0435\u043a\u0441\u0430 \u043d\u0430 \u041c\u0435\u0436\u0435\u0433\u0435\u0439\u0441\u043a\u043e\u043c \u043c\u0435\u0441\u0442\u043e\u0440\u043e\u0436\u0434\u0435\u043d\u0438\u0438 \u0423\u043b\u0443\u0433-\u0425\u0435\u043c\u0441\u043a\u043e\u0433\u043e \u0443\u0433\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u0431\u0430\u0441\u0441\u0435\u0439\u043d\u0430), https://web.archive.org/web/20251224152222/https://mert-tuva.ru/old/directions/investment-policy/investment-projects/mejegey/index.htm, 2020. The boundary is the outer perimeter of these two licenses. The license \u041a\u0417\u041b 14886 \u0422\u042d was issued on March 18, 2010, and is valid until March 22, 2030. The license \u041a\u0417\u041b 15045 \u0422\u042d was issued on November 19, 2010, and is valid until November 8, 2030. The boundary for license \u041a\u0417\u041b 14886 \u0422\u042d was extracted from the NedraExpert portal at https://web.archive.org/web/20251224154527/https://www.nedraexpert.ru/license/150551?ysclid=mjk45v4a5m702187839. The boundary for license \u041a\u0417\u041b 15045 \u0422\u042d was extracted from the NedraExpert portal at https://web.archive.org/web/20251224154513/https://www.nedraexpert.ru/license/150925?ysclid=mjk4cw38y7618189831.The approximate area of the resulting boundary is 146 square km.",
        "description": "Mezhegeyugol Coal Mine boundary",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0820",
        "Owners": "UK Mezhegeyugol LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Raspadskaya PJSC",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Mezhegeyugol_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Mezhegeyugol Coal Mine",
        "Country / Area": "Russia",
        "Last researched": "Dec 23, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          94.115213,
          51.394487
        ]
      },
      "properties": {
        "id": "M0820.P1",
        "mine feature category": "other",
        "mine feature subcategory": "slope access or production shaft",
        "data source date": "2022-06-06 00:00:00",
        "notes": "This slope access or production shaft was identified via visual analysis of Google Earth Pro imagery",
        "description": "Slope access or production shaft",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0820",
        "Owners": "UK Mezhegeyugol LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Raspadskaya PJSC",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Mezhegeyugol_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Mezhegeyugol Coal Mine",
        "Country / Area": "Russia",
        "Last researched": "Dec 23, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          94.113971,
          51.391589
        ]
      },
      "properties": {
        "id": "M0820.P2",
        "mine feature category": "degasification system",
        "mine feature subcategory": "drainage station",
        "data source date": "2022-06-06 00:00:00",
        "notes": "This possible drainage station was identified via visual analysis of Google Earth Pro imagery",
        "description": "Possible drainage station",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0820",
        "Owners": "UK Mezhegeyugol LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Raspadskaya PJSC",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Mezhegeyugol_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Mezhegeyugol Coal Mine",
        "Country / Area": "Russia",
        "Last researched": "Dec 23, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          94.117337,
          51.393292
        ]
      },
      "properties": {
        "id": "M0820.P3",
        "mine feature category": "degasification system",
        "mine feature subcategory": "drainage station",
        "data source date": "2022-06-06 00:00:00",
        "notes": "This possible drainage station was identified via visual analysis of Google Earth Pro imagery",
        "description": "Possible drainage station",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0820",
        "Owners": "UK Mezhegeyugol LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Raspadskaya PJSC",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Mezhegeyugol_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Mezhegeyugol Coal Mine",
        "Country / Area": "Russia",
        "Last researched": "Dec 23, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          94.275554,
          51.353004
        ]
      },
      "properties": {
        "id": "M0820.P4",
        "mine feature category": "ventilation system",
        "mine feature subcategory": "shaft",
        "data source date": "2024-08-30 00:00:00",
        "notes": "This possible system of ventilation shafts was identified via visual analysis of Google Earth Pro imagery",
        "description": "Possible ventilation shaft system",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0820",
        "Owners": "UK Mezhegeyugol LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Raspadskaya PJSC",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Mezhegeyugol_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Mezhegeyugol Coal Mine",
        "Country / Area": "Russia",
        "Last researched": "Dec 23, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    },
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          94.280607,
          51.352834
        ]
      },
      "properties": {
        "id": "M0820.P5",
        "mine feature category": "degasification system",
        "mine feature subcategory": "gas well",
        "data source date": "2024-08-30 00:00:00",
        "notes": "This possible cluster of gas wells was identified via visual analysis of Google Earth Pro imagery",
        "description": "Possible gas wells",
        "coordinates precision": "extracted",
        "GEM Mine ID": "M0820",
        "Owners": "UK Mezhegeyugol LLC [100%]",
        "Owners (Non-ENG)": "",
        "Parent Company": "Raspadskaya PJSC",
        "GEM Wiki Page (ENG)": "https://www.gem.wiki/Mezhegeyugol_coal_mine",
        "GEM Wiki Page (Non-ENG)": "",
        "Coal Grade": "Met",
        "Mine Name": "Mezhegeyugol Coal Mine",
        "Country / Area": "Russia",
        "Last researched": "Dec 23, 2025",
        "build_version": "Coal Mine Boundaries and Methane Sources - version 1.0.1 (built on February 13 2026 18.38.33 EST)"
      }
    }
  ]
}
    var bounds = L.latLngBounds(L.latLng(51.330033, 94.081814), L.latLng(51.478925, 94.437381));                        
    var googleStreet =  L.tileLayer('https://mt0.google.com/vt/lyrs=m&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    var googleHybrid =  L.tileLayer('https://mt0.google.com/vt/lyrs=y&hl=en&x={x}&y={y}&z={z}', {maxZoom: 20, attribution: '&copy; Google Maps'})
    
    // When this map is embedded in the GEM Wiki via an iframe widget, the enclosing html css for width and height of #map does not consistently
    // come through, resulting in sometimes being 0, 0. This seems to mess fitBounds up resulting in a fully zoomed out map showing the entire planet.
    // I tried many different adjustments, but in the end chose a setView with a fixed zoom of 12 to be much more reliable.
    //var map = L.map('map', {layers: [googleStreet, googleHybrid]}).fitBounds(bounds) 
                        
    var map = L.map('map', {layers: [googleStreet, googleHybrid]}).setView([51.404478999999995, 94.2595975], 12.0)                     
    var markerLayerGroup = L.layerGroup();
                        

    function onEachFeature(feature, layer) {
        let popupContent = "<b><u>" + feature.properties['description'] + "</u></b><br /><br />"
        let tooltipContent = feature.properties['id'] + ": " + feature.properties['description']
        for (const [key, value] of Object.entries(feature.properties)) {
            popupContent += '<b>' + key + '</b>: ' + value + '<br />'
        }
        layer.bindPopup(popupContent, { maxHeight: 200 , maxWidth: 400})
        layer.bindTooltip(tooltipContent, { permanent: false, direction: 'right'});
        if (feature.properties['mine feature category'] == "mine boundary") {
           layer.setStyle({ color: '#CA4A50', fillColor: '#CA4A50', opacity: 1.0 });
        }
        markerLayerGroup.addLayer(layer)
	}
    
    markerLayerGroup.addTo(map);
    const mineLayer = L.geoJSON(mine, {onEachFeature}).addTo(map)
    var GEMMineIcon = L.icon({ iconUrl: 'https://maps.google.com/mapfiles/kml/paddle/red-circle.png', iconSize:  [40, 40]});
    
    const myDiv = document.getElementById('map');
    const width = myDiv.offsetWidth;
    const height = myDiv.offsetHeight;
    console.log("#map width: " + width + ", height: " + height);                    

    // Create a "dummy" layer group specifically to act as the tooltip toggle switch in the control
    var tooltipToggleLayer = L.layerGroup();
    // Add event listeners to the map that listen for the toggle layer being added or removed
    map.on('layeradd', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is selected, iterate over all markers and make tooltips permanent
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = true;
                    layer.openTooltip(); // Open the tooltip permanently
                }
            });
        }
    });
    map.on('layerremove', function (e) {
        if (e.layer === tooltipToggleLayer) {
            // When the "Tooltip" overlay is deselected, make tooltips non-permanent and close them
            markerLayerGroup.eachLayer(function (layer) {
                if (layer.getTooltip()) {
                    layer.getTooltip().options.permanent = false;
                    layer.closeTooltip();
                }
            });
        }
    });

    map.on('zoomend', function() {
        console.log("Current zoom level: " + map.getZoom());
    });

    var baseMaps = {
        "Street view": googleStreet,
        "Satellite view": googleHybrid
    };
    var overlayMaps = {
        "Labels": tooltipToggleLayer // The toggle switch for tooltips
    };
    var layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
                        
    var GEMMine;
                        
	GEMMine = L.marker([51.391967, 94.110944], {icon: GEMMineIcon}).addTo(map); 
	GEMMine.bindPopup('Operating status(es): Operating, Cancelled');
	GEMMine.bindTooltip('Mezhegeyugol Coal Mine', { permanent: true, direction: 'right'});
